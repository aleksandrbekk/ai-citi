# üöÄ –ü–õ–ê–ù –ú–ò–ì–†–ê–¶–ò–ò –ù–ê DISCOVERY ENGINE API

**–î–∞—Ç–∞:** 2026-01-27  
**–¶–µ–ª—å:** –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —á–∞—Ç –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Discovery Engine API –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤ GenAI App Builder

---

## ‚úÖ –ß–¢–û –£–ñ–ï –ì–û–¢–û–í–û

### 1. **–ü—Ä–æ–µ–∫—Ç –∏ –±–∏–ª–ª–∏–Ω–≥:**
- ‚úÖ **Project ID:** `gen-lang-client-0102901194`
- ‚úÖ **Billing Account ID:** `01DB30-E9BEE6-19F55A` (–ë–ê–ù–ì–ö–û–ì –ë–ê–ù–ö)
- ‚úÖ **–ü—Ä–æ–µ–∫—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –±–∏–ª–ª–∏–Ω–≥—É:** –î–∞
- ‚úÖ **–ö—Ä–µ–¥–∏—Ç –¥–æ—Å—Ç—É–ø–µ–Ω:** ‡∏ø32,310.50 (GenAI App Builder)

### 2. **API –∏ –∫–æ–¥:**
- ‚úÖ **Discovery Engine API:** –í–∫–ª—é—á–µ–Ω
- ‚úÖ **–§—É–Ω–∫—Ü–∏—è searchRAG:** –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `supabase/functions/gemini-chat/index.ts`
- ‚úÖ **Endpoint:** `https://discoveryengine.googleapis.com/v1/projects/.../locations/global/...`
- ‚úÖ **Service Account:** `ai-citi-assistant@gen-lang-client-0102901194.iam.gserviceaccount.com`

### 3. **–¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –£–∂–µ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ "Vertex AI Search: Advance Generative Answers" (THB 316.34)
- ‚úÖ –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Discovery Engine API —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!

---

## üîç –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨

### **–ó–ê–î–ê–ß–ê 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ Service Account**

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–ß–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å:**
   - –û—Ç–∫—Ä—ã—Ç—å: https://console.cloud.google.com/iam-admin/iam?project=gen-lang-client-0102901194
   - –ù–∞–π—Ç–∏: `ai-citi-assistant@gen-lang-client-0102901194.iam.gserviceaccount.com`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª–∏:
     - ‚úÖ `roles/aiplatform.user` (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å)
     - ‚úÖ `roles/discoveryengine.viewer` –∏–ª–∏ `roles/discoveryengine.admin` (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

2. **–ß–µ—Ä–µ–∑ gcloud CLI:**
   ```bash
   gcloud projects get-iam-policy gen-lang-client-0102901194 \
     --flatten="bindings[].members" \
     --filter="bindings.members:ai-citi-assistant@gen-lang-client-0102901194.iam.gserviceaccount.com" \
     --format="table(bindings.role)"
   ```

3. **–ï—Å–ª–∏ –Ω–µ—Ç —Ä–æ–ª–∏ Discovery Engine:**
   ```bash
   gcloud projects add-iam-policy-binding gen-lang-client-0102901194 \
     --member="serviceAccount:ai-citi-assistant@gen-lang-client-0102901194.iam.gserviceaccount.com" \
     --role="roles/discoveryengine.viewer"
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Service Account –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ Discovery Engine API

---

### **–ó–ê–î–ê–ß–ê 2: –°–æ–∑–¥–∞—Ç—å Data Store –≤ Vertex AI Search**

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å Vertex AI Search:**
   - URL: https://console.cloud.google.com/gen-app-builder/data-stores?project=gen-lang-client-0102901194

2. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Data Store:**
   - –ù–∞–∂–∞—Ç—å "Create Data Store"
   - –í—ã–±—Ä–∞—Ç—å —Ç–∏–ø: **"Unstructured"** (–¥–ª—è PDF, —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤)
   - –ù–∞–∑–≤–∞–Ω–∏–µ: –Ω–∞–ø—Ä–∏–º–µ—Ä, `systema-book` –∏–ª–∏ `ar-arena-docs`
   - –õ–æ–∫–∞—Ü–∏—è: **`global`** (–≤–∞–∂–Ω–æ! –Ω–µ `us-central1`)

3. **–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
   - **–í–∞—Ä–∏–∞–Ω—Ç –ê:** –ó–∞–≥—Ä—É–∑–∏—Ç—å PDF —Ñ–∞–π–ª (—Ç–≤–æ—è –∫–Ω–∏–≥–∞ SystemA)
   - **–í–∞—Ä–∏–∞–Ω—Ç –ë:** –£–∫–∞–∑–∞—Ç—å URL –≤–µ–±-—Å–∞–π—Ç–∞ (Whitepaper AR Arena)
   - **–í–∞—Ä–∏–∞–Ω—Ç –í:** –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ (PDF, TXT, HTML)

4. **–î–æ–∂–¥–∞—Ç—å—Å—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
   - –û–±—ã—á–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç 5-15 –º–∏–Ω—É—Ç
   - –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ "Ready" –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ

5. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Data Store ID:**
   - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è, —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: `systema-book_1234567890`)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Data Store —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω

---

### **–ó–ê–î–ê–ß–ê 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RAG —á–µ—Ä–µ–∑ API**

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–ü–æ–ª—É—á–∏—Ç—å Data Store ID –∏–∑ –∫–æ–Ω—Å–æ–ª–∏**

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ curl:**
   ```bash
   curl -X POST https://YOUR_SUPABASE_URL/functions/v1/gemini-chat \
     -H "Authorization: Bearer YOUR_ANON_KEY" \
     -H "Content-Type: application/json" \
     -d '{
       "message": "–ß—Ç–æ —Ç–∞–∫–æ–µ VWAP?",
       "userId": "test-user-123",
       "useRAG": true,
       "ragDataStoreId": "YOUR_DATA_STORE_ID"
     }'
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç:**
   - –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—Ç–≤–µ—Ç —Å `rag.used: true`
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (sources)
   - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** RAG —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ API

---

### **–ó–ê–î–ê–ß–ê 4: –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è RAG —Ä–µ–∂–∏–º–∞**

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–û–±–Ω–æ–≤–∏—Ç—å Chat.tsx:**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤: "–û–±—ã—á–Ω—ã–π —á–∞—Ç" / "RAG" / "–ì–∏–±—Ä–∏–¥–Ω—ã–π"
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –≤ localStorage
   - –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `useRAG` –∏ `ragDataStoreId` –≤ –∑–∞–ø—Ä–æ—Å

2. **–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –ë–î:**
   - –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `rag_settings` (–µ—Å–ª–∏ –Ω–µ—Ç)
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `data_store_id` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞/–∞–≥–µ–Ω—Ç–∞

3. **–û–±–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**
   - –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É Data Store ID –≤ –∞–¥–º–∏–Ω–∫–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Ä–µ–∂–∏–º—ã

---

## üìä –ü–†–û–í–ï–†–ö–ê –£–°–ü–ï–•–ê

### **–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:**

- ‚úÖ Discovery Engine API –≤–∫–ª—é—á–µ–Ω
- ‚úÖ Service Account –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ `discoveryengine.viewer`
- ‚úÖ Data Store —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω
- ‚úÖ RAG –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç (–≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—Ç–≤–µ—Ç—ã)
- ‚úÖ –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –æ—à–∏–±–æ–∫
- ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏ –±–∏–ª–ª–∏–Ω–≥–∞ –≤–∏–¥–Ω—ã —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ `discoveryengine.googleapis.com`
- ‚úÖ –ö—Ä–µ–¥–∏—Ç "GenAI App Builder" —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è (‡∏ø32,310.50 —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è)

---

## üö® –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### **–ü—Ä–æ–±–ª–µ–º–∞ 1: "Data Store not found"**

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Data Store ID –∏–ª–∏ –ª–æ–∫–∞—Ü–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Data Store —Å–æ–∑–¥–∞–Ω –≤ –ª–æ–∫–∞—Ü–∏–∏ `global` (–Ω–µ `us-central1`)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å ID –≤ –∫–æ–¥–µ

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 2: "Permission denied"**

**–ü—Ä–∏—á–∏–Ω–∞:** Service Account –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤

**–†–µ—à–µ–Ω–∏–µ:**
```bash
gcloud projects add-iam-policy-binding gen-lang-client-0102901194 \
  --member="serviceAccount:ai-citi-assistant@gen-lang-client-0102901194.iam.gserviceaccount.com" \
  --role="roles/discoveryengine.viewer"
```

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 3: "RAG –Ω–µ –Ω–∞—à–µ–ª –æ—Ç–≤–µ—Ç"**

**–ü—Ä–∏—á–∏–Ω–∞:** –í Data Store –Ω–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ Data Store
- –ü–æ–¥–æ–∂–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç)
- –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –≤–æ–ø—Ä–æ—Å

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 4: "–ö—Ä–µ–¥–∏—Ç –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è"**

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥ –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É Billing Account
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Discovery Engine API (–Ω–µ Vertex AI API)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ –±–∏–ª–ª–∏–Ω–≥–∞

---

## üìù –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ Service Account
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å Data Store –≤ –∫–æ–Ω—Å–æ–ª–∏
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RAG —á–µ—Ä–µ–∑ API
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
5. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤

---

## üîó –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò

- **–ö–æ–Ω—Å–æ–ª—å Vertex AI Search:** https://console.cloud.google.com/gen-app-builder/data-stores?project=gen-lang-client-0102901194
- **Discovery Engine API:** https://console.cloud.google.com/apis/library/discoveryengine.googleapis.com?project=gen-lang-client-0102901194
- **IAM:** https://console.cloud.google.com/iam-admin/iam?project=gen-lang-client-0102901194
- **–ë–∏–ª–ª–∏–Ω–≥:** https://console.cloud.google.com/billing/01DB30-E9BEE6-19F55A/reports?project=gen-lang-client-0102901194
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://cloud.google.com/generative-ai-app-builder/docs/overview

---

## ‚úÖ –ò–¢–û–ì

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:**
- ‚úÖ Discovery Engine API –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –ö–æ–¥ —É–∂–µ –≥–æ—Ç–æ–≤ (—Ñ—É–Ω–∫—Ü–∏—è searchRAG)
- ‚úÖ –ï—Å—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ Vertex AI Search (–∑–Ω–∞—á–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!)

**–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:**
- ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ Service Account
- ‚è≥ –°–æ–∑–¥–∞—Ç—å Data Store —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RAG
- ‚è≥ –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤

**–í—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:** ~30-60 –º–∏–Ω—É—Ç
