# CLAUDE.md

> **AI CITI | НЕЙРОГОРОД** — Telegram Mini App для сетевиков.
> MVP НЕЙРОПОСТЕР готов. Заказчики НЕ программисты.

---

## 🛑 STOP-ТОЧКИ (ОБЯЗАТЕЛЬНЫЕ ПАУЗЫ)

**ПЕРЕД любым действием с кодом — ОСТАНОВИСЬ и проверь:**

```
┌─────────────────────────────────────────────────────────────┐
│  🛑 STOP #1: НУЖЕН ЛИ СКИЛЛ?                                │
│                                                             │
│  Задача НЕ тривиальная? (больше чем 1 файл / новый код)    │
│  ├─ ДА → ОБЯЗАН вызвать скилл ПЕРЕД написанием кода        │
│  └─ НЕТ → можешь работать напрямую                         │
│                                                             │
│  ⚠️ ЗАПРЕЩЕНО писать новый компонент без /ui-design        │
│  ⚠️ ЗАПРЕЩЕНО менять UI без /ux-check после                │
└─────────────────────────────────────────────────────────────┘
```

```
┌─────────────────────────────────────────────────────────────┐
│  🛑 STOP #2: ПРОЧИТАЛ ЛИ ФАЙЛ?                             │
│                                                             │
│  ЗАПРЕЩЕНО редактировать файл, который не прочитал         │
│  ЗАПРЕЩЕНО угадывать структуру кода                        │
└─────────────────────────────────────────────────────────────┘
```

```
┌─────────────────────────────────────────────────────────────┐
│  🛑 STOP #3: ПРОВЕРИЛ ЛИ BUILD?                            │
│                                                             │
│  ЗАПРЕЩЕНО коммитить без `npm run build`                   │
│  Ошибка? → Исправь САМ → Потом коммить                     │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔴 ОБЯЗАТЕЛЬНОЕ ИСПОЛЬЗОВАНИЕ СКИЛЛОВ

### Когда скилл ОБЯЗАТЕЛЕН (не рекомендация!):

| Действие | ОБЯЗАН вызвать | Когда |
|----------|----------------|-------|
| Новый компонент | `/ui-design` | ПЕРЕД написанием |
| Новая страница | `/ui-ux-pro-max` | ПЕРЕД написанием |
| Изменение UI | `/ux-check` | ПОСЛЕ изменения |
| React логика | `/react-best-practices` | ПЕРЕД написанием |
| Telegram API | `/telegram-mini-app` | ПЕРЕД использованием |
| Промпт/AI | `/prompt-engineer` | ПЕРЕД написанием |
| Деплой | `/deploy` | ПЕРЕД деплоем |

### Алгоритм выбора скилла:

```
ПОЛУЧИЛ ЗАДАЧУ
     │
     ▼
┌─ Это тривиально? (опечатка, 1 строка, удаление)
│   └─ ДА → работай напрямую, скилл не нужен
│
└─ НЕТ (новый код, несколько файлов, UI, логика)
        │
        ▼
   ┌─ UI/UX задача?
   │   ├─ Новое → ВЫЗОВИ /ui-design
   │   ├─ Изменение → ВЫЗОВИ /ux-check после
   │   └─ Проверка → ВЫЗОВИ /ui-visual-validator
   │
   ├─ React/TypeScript?
   │   ├─ Компонент → ВЫЗОВИ /react-best-practices
   │   └─ Типы → ВЫЗОВИ /typescript-expert
   │
   ├─ Telegram?
   │   └─ ВЫЗОВИ /telegram-mini-app
   │
   ├─ Backend/API?
   │   ├─ API → ВЫЗОВИ /api-design-principles
   │   └─ Edge Function → ВЫЗОВИ /supabase-deploy
   │
   └─ Деплой?
       └─ ВЫЗОВИ /deploy
```

### ⛔ НАРУШЕНИЕ = БАГ

```
❌ Написал компонент без /ui-design = НАРУШЕНИЕ
❌ Изменил UI без /ux-check = НАРУШЕНИЕ
❌ Создал страницу без /ui-ux-pro-max = НАРУШЕНИЕ
❌ Проигнорировал скилл "потому что знаю как" = НАРУШЕНИЕ
```

---

## 🚨 КРИТИЧЕСКИЕ ПРАВИЛА

### 1. ВСЕГДА ПУШИ
```bash
git add . && git commit -m "тип: описание" && git push
```
После КАЖДОГО изменения. Без исключений.

### 2. ВСЕГДА ПРОВЕРЯЙ ПЕРЕД КОММИТОМ
```bash
npm run build
```
Сломано → исправь сам → только потом коммить.

### 3. ДЕЛАЙ ВСЁ САМ
Заказчики НЕ знают git, npm, терминал. **Никогда не проси их:**
- запускать команды
- проверять код
- смотреть логи

**Говори просто:** "Готово! Добавил кнопку." / "Исправил баг."

### 4. НЕ ЛОМАЙ
- Прочитай файл ПЕРЕД изменением
- Меняй ТОЛЬКО то, что просят
- НЕ рефактори "заодно"
- НЕ добавляй "на будущее"

---

## 🧠 АЛГОРИТМ РАБОТЫ

```
ЗАДАЧА ПОЛУЧЕНА
      │
      ▼
[1] ПОНЯТЬ — Что просят? Переформулируй.
      │
      ▼
[2] НАЙТИ — Какие файлы? Прочитай их.
      │
      ▼
[3] 🛑 STOP: СКИЛЛ НУЖЕН?
      │
      ├─ Тривиально → пропусти
      └─ Нет → ВЫЗОВИ СКИЛЛ (см. таблицу выше)
      │
      ▼
[4] СДЕЛАТЬ — Минимальные изменения.
      │
      ▼
[5] 🛑 STOP: /ux-check НУЖЕН? (если менял UI)
      │
      ▼
[6] ПРОВЕРИТЬ — npm run build
      │
      ▼
[7] SELF-CHECK (см. чеклисты ниже)
      │
      ▼
[8] ЗАКОММИТИТЬ — git add . && git commit && git push
```

---

## ✅ SELF-CHECK ЧЕКЛИСТЫ

### После UI изменений:
```
☐ ВЫЗВАЛ /ux-check?
☐ Использовал оранжевый (#FF5A1F) для CTA?
☐ Использовал бирюзовый (#06B6D4) для вторичных?
☐ НЕ использовал фиолетовый/розовый/синий?
☐ Добавил hover/active состояния?
☐ cursor-pointer на кликабельных элементах?
☐ aria-label на иконках-кнопках?
```

### После создания компонента:
```
☐ ВЫЗВАЛ /ui-design ПЕРЕД написанием?
☐ Функциональный компонент?
☐ TypeScript интерфейс для props?
☐ Нет any?
```

### После React изменений:
```
☐ ВЫЗВАЛ /react-best-practices?
☐ React Query для серверных данных?
☐ Zustand для глобального стейта?
☐ useEffect с правильными зависимостями?
```

### Перед каждым коммитом:
```
☐ npm run build проходит?
☐ Изменил только то, что просили?
☐ Не добавил лишнего?
☐ Если UI → вызвал /ux-check?
```

---

## 🎨 ДИЗАЙН-СИСТЕМА (СТРОГО!)

### Цвета — ЕДИНСТВЕННЫЕ разрешённые:

| Роль | Цвет | Tailwind |
|------|------|----------|
| **Primary** | `#FF5A1F` | `orange-500`, `from-orange-400 to-orange-500` |
| **Secondary** | `#06B6D4` | `cyan-500`, `from-cyan-400 to-cyan-500` |
| **Background** | `#FFFFFF` / `#FFF8F5` | `bg-white`, `bg-[#FFF8F5]` |
| **Text** | `#1A1A1A` | `text-gray-900` |

### 🚫 ЗАПРЕЩЁННЫЕ ЦВЕТА:
```
❌ purple — ЗАПРЕЩЕНО
❌ pink — ЗАПРЕЩЕНО
❌ blue (кроме info) — ЗАПРЕЩЕНО
```

### Шаблоны:
```tsx
// Glassmorphism
className="bg-white/80 backdrop-blur-xl border border-white/60 rounded-2xl shadow-sm"

// CTA кнопка
className="bg-gradient-to-r from-orange-400 to-orange-500 text-white rounded-xl px-4 py-2 hover:shadow-lg transition-all duration-200 cursor-pointer"
```

---

## 📁 СТРУКТУРА

```
src/
├── pages/          # Страницы
├── components/     # Компоненты (ui/ = shadcn)
├── hooks/          # React хуки
├── store/          # Zustand
├── lib/            # Утилиты
└── types/          # TypeScript типы

supabase/
├── migrations/     # SQL
└── functions/      # Edge Functions (Deno)
```

---

## 🔧 СТЕК

```
Frontend: React 18 + Vite + TypeScript + TailwindCSS + shadcn/ui
Backend:  Supabase (PostgreSQL + Edge Functions) + n8n
Deploy:   Vercel
```

---

## ❌ АНТИПАТТЕРНЫ

```tsx
// ❌ ЗАПРЕЩЕНО
style={{ backgroundColor: 'purple' }}  // inline + запрещённый цвет
const data: any = await fetch(...)      // any
class MyComponent extends Component {}   // классовый компонент

// ✅ ПРАВИЛЬНО
className="bg-orange-500"               // Tailwind + правильный цвет
const data: Post[] = await fetch(...)   // типизация
function MyComponent() {}               // функциональный
```

---

## 🔒 БЕЗОПАСНОСТЬ

- `.env.local` — НИКОГДА в git
- Service Role Key — ТОЛЬКО на сервере
- RLS — на КАЖДОЙ таблице
- Валидация — на ВСЕХ inputs

---

## 👥 АДМИНЫ

```typescript
const ADMIN_IDS = [643763835, 190202791]
```

---

## 📚 ДОПОЛНИТЕЛЬНЫЕ ПРАВИЛА

| Область | Файл |
|---------|------|
| Frontend | `.claude/rules/frontend.md` |
| Backend | `.claude/rules/backend.md` |
| Database | `.claude/rules/database.md` |
| Дизайн | `.claude/rules/ai-citi-design-system.md` |

---

## 📋 ROADMAP

**Перед работой:** `docs/ROADMAP_IMPROVEMENTS.md`

1. Отметь: `🔄 В работе (@Claude)`
2. Сделай задачу
3. Отметь: `✅ Готово (@Claude, дата)`
4. Закоммить ROADMAP вместе с кодом

---

## 🔄 ОТКАТ

```bash
git checkout -- .          # Незакоммиченные
git revert HEAD && git push # Последний коммит
```

Скажи заказчику что произошло (простыми словами).
